<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">

	<!--Import Google Icon Font-->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<!-- Compiled and minified CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.99.0/css/materialize.min.css">
	<style>
		body {
			margin-top: 30px;
		}

		#users a {
			display: block;
			margin-bottom: 8px;
		}

		#users a .material-icons {
			vertical-align: bottom;
		}

		#chat .material-icons {
			vertical-align: middle;
		}
	</style>

	<!-- Compiled and minified JavaScript -->
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.99.0/js/materialize.min.js"></script>
	<script type="text/javascript" src="/socket.io/socket.io.js"></script>
	<title>Socket.io Chat App</title>
</head>

<body>
	<div class="container">
		<h3>Socket.io Chat App</h1>

      <div class="row" id="messageArea">
        <div class="col m4 s12">
          <div class="card" id="users">
            <div class="card-content">
              <span class="card-title">Online Users</span>
                  <p>
                    <a><i class="material-icons">perm_identity</i> Username</a>
                  </p>
            </div>
          </div>
        </div>
        <div class="col m8 s12">
              <div id="chat"></div>
              <form id="messageForm">
                <div class="input-field col s12">
                  <textarea id="message" class="materialize-textarea"></textarea>
                  <label for="message">Message</label>
                </div>
                <input type="submit" value="send" class="waves-effect waves-light btn right"></input>
              </form>
              <br style="clear:both;">
        </div>
      </div>
    </div>
    <script type="text/javascript">
      // Materialize Main Text area init
      // $('#message').val('Start typing...');
      $('#message').trigger('autoresize');

      // Socket.io
      $(function(){
        var socket = io.connect();
        var $messageForm = $('#messageForm');
        var $message = $('#message');
        var $chat = $('#chat');

        $messageForm.submit(function(e){
          e.preventDefault();
          // console.log('Submitted');
          socket.emit('send message', $message.val());
          $message.val('');
        });

        // socket.on('new message', function(data){
        //   $chat.append('<div class="card"><div class="card-content"><p><i class="material-icons">perm_identity</i> ' +data.msg+ '</p></div></div>');
        // });
        socket.on('new message', function(data){
          $chat.append('<div class="chip"><i class="material-icons">perm_identity</i> ' +data.msg+ '</div><br>');
        });
      });
    </script>
  </body>
  </html>
